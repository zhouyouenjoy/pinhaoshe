{% extends 'common.html' %}
{% block title %}摄影活动{% endblock %}
{% block content %}
{% load static %}
<style>
    @import url('{% static "css/event/event_list.css" %}');
    .hidden-place {
        visibility: hidden; /* 隐藏内容，但保留空间 */
        height: 10px;
    }
</style>
    <div class="hidden-place">占位</div>
    
    <div class="container-fluid">  
    <div class="row" id="event-list">
        {% include 'event/event_list_content.html' %}
    </div>
    
</div>
<!-- 加载更多按钮容器 -->
<div id="load-more-container" class="text-center my-4" style="display: none;">
    <button id="loadevent-more-btn" class="loadevent-more-btn">加载更多</button>
    <div id="loading-spinner" class="spinner" role="status" style="display: none;">
        <span class="visually-hidden">加载中...</span>
    </div>
</div>

<!-- 底部加号按钮 -->
<a href="{% url 'event:create_event' %}" class="add-event-btn" id="add-event-btn">
    <i class="fas fa-plus"></i>
</a>

<script>
// 处理创建活动按钮点击事件
document.getElementById('add-event-btn').addEventListener('click', function(e) {
    e.preventDefault();
    
    // 发送 AJAX 请求检查用户权限
    fetch('{% url "event:create_event" %}', {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]') ? document.querySelector('[name=csrfmiddlewaretoken]').value : '',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success === false) {
            // 显示权限不足的提醒
            alert(data.message);
        } else {
            // 用户有权限，跳转到创建活动页面
            window.location.href = '{% url "event:create_event" %}';
        }
    })
    .catch(error => {
        // 出现错误时也跳转到创建活动页面，让后端处理权限检查
        window.location.href = '{% url "event:create_event" %}';
    });
});
</script>

{% endblock %}