{% load static %}
<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <meta charset="utf-8">
    <!-- 引入favicon -->
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <!-- 设置视口，使页面在移动设备上正确显示 -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
   
    <!-- 页面标题，使用Django模板标签定义可被子模板覆盖的块 -->
    <title>{% block title %}拼好摄{% endblock %}</title>
    <!-- 引入Bootstrap CSS框架 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入Font Awesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- 自定义样式表 -->
    <link rel="stylesheet" href="{% static 'css/photos/style.css' %}?v=1.0.0">
    <!-- 评论系统样式表 -->
    <link rel="stylesheet" href="{% static 'css/photos/comments.css' %}?v=1.0.0">
    
    {% block css %}
    {% endblock %}
   
</head>
{% load static %}
<body>
    <!-- 主要内容容器，设置上边距 -->
    <div class="{% block container_class %}container-fluid{% endblock %} main-content">
        <!-- 显示Django消息框架中的消息 -->
        {% if messages %}
            {% for message in messages %}
                <!-- 根据消息类型设置不同的样式 -->
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <!-- 关闭按钮 -->
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        <!-- 内容块，子模板可以覆盖此部分 -->
        {% block content %}
        {% endblock %}
    </div>
    
    <!-- 引入Bootstrap JavaScript组件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 自定义JS -->
    <script src="{% static 'js/main.js' %}?v=1.0.0"></script>
    <script>
        // 辅助函数：从cookie获取CSRF令牌
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // 初始化页面功能
        function initializePage() {
            // 清理之前的状态
            cleanupPreviousState();
            
            // 初始化各种页面的懒加载功能（如果存在）
            if (typeof initLazyLoading === 'function') {
                initLazyLoading();
            }
            if (typeof initFollowingLazyLoading === 'function') {
                initFollowingLazyLoading();
            }
            if (typeof initEventLazyLoading === 'function') {
                initEventLazyLoading();
            }
        }

        // 清理之前的状态，防止内存泄漏和事件重复绑定
        function cleanupPreviousState() {
            // 清理已有的事件监听器状态
            if (window.lazyLoadingState) {
                window.removeEventListener('scroll', window.lazyLoadingState.handleScroll);
                delete window.lazyLoadingState;
            }
            if (window.followingLazyLoadingState) {
                window.removeEventListener('scroll', window.followingLazyLoadingState.handleScroll);
                delete window.followingLazyLoadingState;
            }
            if (window.eventLazyLoadingState) {
                window.removeEventListener('scroll', window.eventLazyLoadingState.handleScroll);
                delete window.eventLazyLoadingState;
            }
        }
    </script>
    {% csrf_token %}
</body>
</html>